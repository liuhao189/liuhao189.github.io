<!DOCTYPE html>
<html>
<head>
  <title>二分查找细节详解</title>
  <link rel="stylesheet" href="/note/note.css">
</head>
<body>
<h1 id="-">二分查找细节详解</h1>
<h1 id="-">二分查找</h1>
<p>二分查找真的很简单吗？思路很简单，细节是魔鬼。寻找一个数，寻找左侧边界，寻找右侧边界，不等号是否应该带等号，mid是否应该加一等等。</p>
<h1 id="-">有序数组查找特定值</h1>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">findIndex</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nums</span> <span class="o">||</span> <span class="o">!</span><span class="nx">nums</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">resultIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">mid</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">parseInt</span><span class="p">((</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">resultIndex</span> <span class="o">=</span> <span class="nx">mid</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&lt;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">right</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&gt;</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">left</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">resultIndex</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<p>Q、为什么while循环的条件是&lt;=，而不是&lt;？</p>
<p>因为right的赋值是nums.length-1，即最后一个元素的索引，而不是nums.length。</p>
<p>Q、什么时候应该停止搜索？</p>
<p>找到目标值的时候，或搜索区间为空的时候应该终止。</p>
<p>Q、为什么left=mid+1，right=mid-1？</p>
<p>搜索区间的概念，二分查找的一个难点。mid已经搜索过了，应该从搜索区间中去除。</p>
<p>Q、有啥缺陷？</p>
<p>不能找到左侧边界索引，或右侧边界索引。</p>
<h1 id="-">寻找左侧边界的二分搜索</h1>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">findLeftIndex</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nums</span> <span class="o">||</span> <span class="o">!</span><span class="nx">nums</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">target</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="nx">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">resultIndex</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">mid</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">parseInt</span><span class="p">((</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">midVal</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">midVal</span> <span class="o">===</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">right</span> <span class="o">=</span> <span class="nx">mid</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&gt;</span> <span class="nx">midVal</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">left</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&lt;</span> <span class="nx">midVal</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">right</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span> <span class="o">===</span> <span class="nx">target</span> <span class="o">?</span> <span class="nx">left</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<p>Q：为什么算法能够搜索左侧边界？</p>
<p>关键在于对nums[mid]===target这种情况的处理, if(nums[mid]===target){right=mid;}。</p>
<p>Q：为什么返回left而不是right？</p>
<p>都是一样的，因为while的终止条件是left===right。</p>
<h1 id="-">寻找右侧边界的二分查找</h1>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">//[1,2,2,2,3],2</span>
<span class="kd">function</span> <span class="nx">findRightIndex</span><span class="p">(</span><span class="nx">nums</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nums</span> <span class="o">||</span> <span class="o">!</span><span class="nx">nums</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">target</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="nx">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">mid</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">parseInt</span><span class="p">((</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">right</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">midVal</span> <span class="o">=</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">midVal</span> <span class="o">===</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">left</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&gt;</span> <span class="nx">midVal</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">left</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">&lt;</span> <span class="nx">midVal</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">right</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">right</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">target</span> <span class="o">?</span> <span class="nx">right</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<p>Q：为什么这个算法能够找到右侧边界？</p>
<p>关键点在于if(nums[mid]===target){left=mid+1;}，不是立即返回，而是增大搜索区间的下界left，使得区间不断向右收缩。</p>
<h1 id="-">总结</h1>
<p>基本的二分查找算法：</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">let</span> <span class="nx">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">right</span><span class="o">=</span><span class="nx">nums</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="k">while</span><span class="p">(</span><span class="nx">left</span><span class="o">&lt;</span><span class="nx">right</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">]</span><span class="o">&gt;</span><span class="nx">target</span><span class="p">){</span>
        <span class="nx">right</span><span class="o">=</span><span class="nx">mid</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">]</span><span class="o">&lt;</span><span class="nx">target</span><span class="p">){</span>
        <span class="nx">left</span><span class="o">=</span><span class="nx">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<p>左侧边界&amp;&amp;右侧边界：</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="k">while</span><span class="p">(</span><span class="nx">left</span><span class="o">&lt;</span><span class="nx">right</span><span class="p">){</span>
    <span class="c1">//左侧边界</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">]</span><span class="o">===</span><span class="nx">target</span><span class="p">){</span>
        <span class="nx">right</span><span class="o">=</span><span class="nx">mid</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//右侧边界</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">nums</span><span class="p">[</span><span class="nx">mid</span><span class="p">]</span><span class="o">===</span><span class="nx">target</span><span class="p">){</span>
        <span class="nx">left</span><span class="o">=</span><span class="nx">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 左侧边界</span>
<span class="k">return</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="p">]</span><span class="o">===</span><span class="nx">target</span><span class="o">?</span><span class="nx">left</span><span class="o">:-</span><span class="mi">1</span><span class="p">;</span>
<span class="c1">// 右侧边界</span>
<span class="k">return</span> <span class="nx">nums</span><span class="p">[</span><span class="nx">left</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="nx">target</span><span class="o">?</span><span class="nx">left</span><span class="o">-</span><span class="mi">1</span><span class="o">:-</span><span class="mi">1</span><span class="p">;</span>
</pre></div>

</code></pre>
<p>注意：</p>
<p>分支二分代码时，不要出现else，全部展开成else if方便理解。</p>
<p>注意搜索区间和while的终止条件，如果存在漏掉的元素，记得在最后检查。</p>
<p>搜索左右边界时，只要在nums[mid]===target时修改即可，搜索右侧时需要减一。</p>
<h1 id="-">参考文献</h1>
<p><a href="https://zhuanlan.zhihu.com/p/79553968">https://zhuanlan.zhihu.com/p/79553968</a></p>
</body>
</html>
