<!DOCTYPE html>
<html>
<head>
  <title>RxJS学习笔记</title>
  <link rel="stylesheet" href="/note/note.css?ts=1638288660921">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><link rel="shortcut icon" href="/ico.png"></head>
<body><script>var _hmt = _hmt || [];
(function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?256376ad73e3e50091706bb3c032e74c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>
<h1 id="rxjs-">RxJS学习笔记</h1>
<p>rxjs是一个使用可观察序列来处理异步和基于事件的程序的一个类库。它提供一个核心的类型Observabele，辅助类型(Observer，Schedulers，Subjects)和运算符(map, filter, reduce, every等)。</p>
<h2 id="-">基本概念</h2>
<p>1、Observable，代表未来的值或事件的调用集合。</p>
<p>2、Observer，是一个知道如何处理Observable投递的值的回调函数的列表。</p>
<p>3、Subscription，表示Observable的执行，主要用于取消执行。</p>
<p>4、Operators，是纯函数，支持函数式编程风格来处理数据。</p>
<p>5、Subject，等效于事件发射器，是多播一个值或事件到多个观察者的唯一方式。</p>
<p>6、Schedulers，集中式调度器来控制并发性，允许我们在计算发生时进行协调。</p>
<h2 id="-">第一个示例</h2>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">ev</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">at</span> <span class="nx">$</span><span class="p">{</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toString</span><span class="p">()}</span><span class="err">`</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<h2 id="-">纯函数产生值</h2>
<p>RxJS的强大之处在于可使用纯函数来产生值。这意味着你的代码更少出错。 </p>
<p>当然你也可以使用不纯的函数，但是状态会很混乱。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="o">++</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="err">`</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>使用RxJS可以隔离状态。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">scan</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">count</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="err">`</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

</code></pre>
<p>scan运算符的工作方式和数组的reduce类似。回调的返回值会作为下一个回调的参数。</p>
<h2 id="flow">Flow</h2>
<p>RxJS具有一系列的运算符来帮你控制事件在Observerable的流动。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">//旧方式来限制点击频率</span>
<span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">rate</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">rate</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">lastClick</span> <span class="o">&gt;=</span> <span class="nx">rate</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="o">++</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="err">`</span><span class="p">);</span>
    <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>使用RxJS：</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">throttleTime</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="nx">scan</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="o">!</span><span class="err">`</span><span class="p">)</span>
    <span class="p">})</span>
</pre></div>

</code></pre>
<p>其它的流的处理运算符有filter，delay，debounceTime，take，takeUntil，distinct，distinctUntilChanged等。</p>
<h2 id="values">Values</h2>
<p>你可以转换经过Observables的值。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">rate</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">rate</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">lastClick</span> <span class="o">&gt;=</span> <span class="nx">rate</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">count</span> <span class="o">+=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">count</span><span class="p">);</span>
    <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>使用RxJS：</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">throttleTime</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
    <span class="nx">map</span><span class="p">((</span><span class="nx">ev</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientX</span><span class="p">),</span>
    <span class="nx">scan</span><span class="p">((</span><span class="nx">count</span><span class="p">,</span> <span class="nx">clientX</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">count</span> <span class="o">+</span> <span class="nx">clientX</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Count</span> <span class="nx">is</span> <span class="nx">$</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>其它的值生运算符，pluck，pairwise，sample等。</p>
<h2 id="-">参考文档</h2>
<p>1、<a href="https://rxjs.dev/guide/overview">https://rxjs.dev/guide/overview</a></p>
</body>
</html>
