<!DOCTYPE html>
<html>
<head>
  <title>RxJS学习笔记</title>
  <link rel="stylesheet" href="/note/note.css?ts=1638893604191">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><link rel="shortcut icon" href="/ico.png"></head>
<body><script>var _hmt = _hmt || [];
(function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?256376ad73e3e50091706bb3c032e74c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>
<h1 id="rxjs-">RxJS学习笔记</h1>
<p>rxjs是一个使用可观察序列来处理异步和基于事件的程序的一个类库。它提供一个核心的类型Observable，辅助类型(Observer，Schedulers，Subjects)和运算符(map, filter, reduce, every等)。</p>
<h2 id="-">基本概念</h2>
<p>1、Observable，代表未来的值或事件的调用集合。</p>
<p>2、Observer，是一个知道如何处理Observable投递的值的回调函数的列表。</p>
<p>3、Subscription，表示Observable的执行，主要用于取消执行。</p>
<p>4、Operators，是纯函数，支持函数式编程风格来处理数据。</p>
<p>5、Subject，等效于事件发射器，是多播一个值或事件到多个观察者的唯一方式。</p>
<p>6、Schedulers，集中式调度器来控制并发性，允许我们在计算发生时进行协调。</p>
<h2 id="-">第一个示例</h2>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">ev</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">at</span> <span class="nx">$</span><span class="p">{</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toString</span><span class="p">()}</span><span class="err">`</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<h2 id="-">纯函数产生值</h2>
<p>RxJS的强大之处在于可使用纯函数来产生值。这意味着你的代码更少出错。 </p>
<p>当然你也可以使用不纯的函数，但是状态会很混乱。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="o">++</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="err">`</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>使用RxJS可以隔离状态。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">scan</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">count</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="err">`</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

</code></pre>
<p>scan运算符的工作方式和数组的reduce类似。回调的返回值会作为下一个回调的参数。</p>
<h2 id="flow">Flow</h2>
<p>RxJS具有一系列的运算符来帮你控制事件在Observerable的流动。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">//旧方式来限制点击频率</span>
<span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">rate</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">rate</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">lastClick</span> <span class="o">&gt;=</span> <span class="nx">rate</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="o">++</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="err">`</span><span class="p">);</span>
    <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>使用RxJS：</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">throttleTime</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="nx">scan</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Clicked</span> <span class="nx">$</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span> <span class="nx">times</span><span class="o">!</span><span class="err">`</span><span class="p">)</span>
    <span class="p">})</span>
</pre></div>

</code></pre>
<p>其它的流的处理运算符有filter，delay，debounceTime，take，takeUntil，distinct，distinctUntilChanged等。</p>
<h2 id="values">Values</h2>
<p>你可以转换经过Observables的值。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">rate</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">rate</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">lastClick</span> <span class="o">&gt;=</span> <span class="nx">rate</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">count</span> <span class="o">+=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">count</span><span class="p">);</span>
    <span class="nx">lastClick</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>使用RxJS：</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">throttleTime</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
    <span class="nx">map</span><span class="p">((</span><span class="nx">ev</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientX</span><span class="p">),</span>
    <span class="nx">scan</span><span class="p">((</span><span class="nx">count</span><span class="p">,</span> <span class="nx">clientX</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">count</span> <span class="o">+</span> <span class="nx">clientX</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">count</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Count</span> <span class="nx">is</span> <span class="nx">$</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>其它的值生运算符，pluck，pairwise，sample等。</p>
<h2 id="observable">Observable</h2>
<p>Observable是惰性推送多个数据的方式。</p>
<p>1、Pull，单个数据使用Function，多个数据使用Iterator。</p>
<p>2、Push，单个数据使用Promise，多个数据使用Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="nx">subscriber</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
        <span class="nx">subscriber</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">})</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Just before subscribe&#39;</span><span class="p">);</span>

<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Get</span> <span class="nx">value</span> <span class="nx">$</span><span class="p">{</span><span class="nx">x</span><span class="p">}</span><span class="err">`</span><span class="p">);</span> <span class="p">},</span>

    <span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">something</span> <span class="nx">wrong</span> <span class="nx">occurred</span><span class="o">:</span> <span class="err">`</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">complete</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<h3 id="pull-vs-push">pull VS push</h3>
<p>Pull和Push是两种不同的方式来描述数据生产者和数据消费者如何沟通。</p>
<p>什么是Pull？Pull是数据消费者决定什么时间来获取数据。JS方法的调用是Pull的方式来获取数据。ES2015引入了生成器函数和迭代器，另外一种pull的方式。调用iterator.next的代码是消费者。</p>
<p>1、Pull，数据生产者是被动的，在请求时才生产数据；数据消费者是主动的，决定何时调用数据。</p>
<p>2、Push，数据生产者按自己的节奏产生数据；数据消费者是被动的，随时准备接收数据。</p>
<p>什么是Push? 数据生产者决定何时发送数据到数据消费者。消费者不知道它什么时候收到数据。Promise是最常见的实现Push的方式。RxJS引进了Observable，一种新的Push的方式。一个Observable可以产生多个值，然后push这些值到Observers。</p>
<h3 id="observables-">Observables的概念</h3>
<p>与主流说法不同，Observables既不像EventEmitters，也不像多个值的Promise。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">42</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span> <span class="c1">// same as foo()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span> <span class="c1">// same as foo()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</pre></div>

</code></pre>
<p>使用RxJS来写，会写成下面的代码。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="nx">subscriber</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
  <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">y</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>函数和Observables都是懒惰计算的。如果你不调用subscribe，它就不会计算。函数调用和Observable的订阅都是独立的操作。</p>
<p>EventEmitters会共享副作用，并且不管有没有订阅者，都会执行。订阅Observable类似于调用函数。Observables可以以同步或异步的方式来发送数据。</p>
<p>Observables和函数的最大区别是，Observables可以随着时间的推移发送多个数据。</p>
<h3 id="observable-">Observable的解剖</h3>
<p>Observables可使用new Observable或生成器运算符来创建，被Observer订阅，使用next/error/complete来通知Observer。</p>
<p>Observables的核心概念：</p>
<p>1、创建Observables；2、订阅Observables；3、执行Observable；4、清理Observables的执行。</p>
<h4 id="-observable">创建Observable</h4>
<p>Observable的构造函数接受一个参数，subscribe方法。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="kd">function</span> <span class="nx">subscribe</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">)</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>通常，observables是被创建类方法创建的，eg：of，from，interval等。</p>
<h4 id="-observable">订阅Observable</h4>
<p>observable.subscribe和observable的构造函数的参数名subscribe有相同的名字，并不是巧合。在库中，它们是不同的，但是你可以将它们认为在概念上相等。</p>
<p>每一次observable.subscribe的调用，构造函数中subscribe的参数方法会重新执行，来设置单独的执行环境。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>这个addEventListener和removeEventListener有很大不同。</p>
<p>订阅动作可以开始Observable的执行，然后发送数据或事件到那次执行的Observer。</p>
<h4 id="-observables">运行Observables</h4>
<p>new Observable(function subscribe(subscriber){...})里面的代码代表Observable的执行。</p>
<p>每一个订阅的观察者都会触发一次执行，没有观察者订阅则不执行。代码的执行可以随着时间的流逝以异步或同步的方式产生多个值。</p>
<p>执行中可以发送三种类型的值：</p>
<p>1、Next，发送Number，String，Object等。</p>
<p>2、Error，发送Error对象。</p>
<p>3、Complete，不发送任何值。</p>
<p>如果已经发送过Error或Complete通知，其它的任何东西都不会再发送。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="kd">function</span> <span class="nx">subscribe</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="c1">// delivers an error if it caught one</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<h4 id="-">清理资源</h4>
<p>因为Observavle的数据可能会有无限次，某些情况下，可能在接收到足够的数据后就需要终止Observable的执行。我们需要一个API来取消执行。</p>
<p>subscribe的方法会返回一个Subscription对象。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>你可以使用subscription.unsubscribe来取消进行的执行。</p>
<p>每一个Observable需要定义怎么清理那次执行的资源。你可以通过subscribe参数的返回值来指定一个自定义的unsubscribe方法。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">(</span><span class="kd">function</span> <span class="nx">subscribe</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Keep track of the interval resource</span>
  <span class="kr">const</span> <span class="nx">intervalId</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">subscriber</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

  <span class="c1">// Provide a way of canceling and disposing the interval resource</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">unsubscribe</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalId</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<h2 id="observer">Observer</h2>
<p>一个Observer是一个Observable发送数据的消费者。Observer只是一些回调函数集合(next，error，complete)。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">next</span><span class="o">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Observer got a next value: &#39;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="nx">error</span><span class="o">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Observer got an error: &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="nx">complete</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Observer got a complete notification&#39;</span><span class="p">),</span>
<span class="p">};</span>

<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>
</pre></div>

</code></pre>
<p>也可以只提供部分回调，如果只提供了部分回调，Observable的执行是正常的，只是一些类型的通知会被忽略。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">next</span><span class="o">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Observer got a next value: &#39;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="nx">error</span><span class="o">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Observer got an error: &#39;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
<span class="p">};</span>
</pre></div>

</code></pre>
<p>调subscribe函数时，如果你只提供一个函数参数，subscribe会创建一个Observer对象，并将参数提供的函数作为新创建的Observer对象的next属性。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Observer got a next value: &#39;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<h2 id="rxjs-operators">RxJS Operators</h2>
<p>尽管Observable是基础，但是RxJS的操作符是最重要的。操作符是以声明方式轻松组合复杂异步代码的关键部分。</p>
<h3 id="-">什么是操作符</h3>
<p>操作符是方法。有两种类型的操作符：</p>
<h4 id="pipeable-">Pipeable运算符</h4>
<p>pipeable运算符是可以用observableInstance.pipe(operator())的方式调用的运算符。eg：filter，mergeMap等。</p>
<p>当调用时，它们不改变已经存在的Observable实例，而是返回一个订阅逻辑基于已存在的Observable的实例的新的Observable。</p>
<p>一个Pipeable运算符是一个纯函数，输入参数为一个Observable实例，返回另一个Observable。订阅输出的Observable也会订阅输入的Observable。</p>
<p>总结：只是一个转换，根据旧的Observable来生成新的Observeable。</p>
<h4 id="-">创建类运算符</h4>
<p>可以独立调用来创建新的Observable实例的函数。eg：of(1，2，3)。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">of</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">map</span><span class="p">,</span><span class="nx">first</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>

<span class="nx">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">),</span> <span class="nx">first</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">value</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">v</span><span class="p">}</span><span class="err">`</span><span class="p">));</span>
<span class="c1">// map返回新的Observable  </span>
</pre></div>

</code></pre>
<p>总结：根据一些常见的数据结构或场景来创建Observable。</p>
<h3 id="piping">Piping</h3>
<p>Pipeable运算符是函数，因此它们可能会嵌套使用。eg：op1(op2(op3(op4())))，会变得不容易阅读和理解。</p>
<p>为了解决这个问题，Observable有一个pipe方法来完成相同的事情，但是更容易阅读和理解。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">obs</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">op1</span><span class="p">(),</span><span class="nx">op2</span><span class="p">(),</span><span class="nx">op3</span><span class="p">(),</span><span class="nx">op4</span><span class="p">());</span>
<span class="c1">//从左到右的顺序去执行。</span>
</pre></div>

</code></pre>
<p>总结：pipe方法只是方便理解和调用，按从左到右的顺序去调用。</p>
<h3 id="-">创建运算符</h3>
<p>创建运算符是一些用来创建Observable的函数。Observable有一些常见的逻辑，或和其它Observable联合。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">interval</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span> <span class="cm">/* number of milliseconds */</span><span class="p">);</span>
</pre></div>

</code></pre>
<h3 id="-observables">高阶Observables</h3>
<p>Observable发送数据的常见类型为numbers或string，但也有一些情况需要返回Observable对象。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">fileObservable</span> <span class="o">=</span> <span class="nx">urlObservable</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">((</span><span class="nx">url</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)));</span>
</pre></div>

</code></pre>
<p>conctaAll可以把Observable数组转换为普通的Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">fileObservable</span> <span class="o">=</span> <span class="nx">urlObservable</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
  <span class="nx">map</span><span class="p">((</span><span class="nx">url</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)),</span>
  <span class="nx">concatAll</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>

</code></pre>
<p>concatAll运算符可以订阅所有的Observable，然后拷贝所有Observable发送的值直到Observable完成。</p>
<p>其它的可以打平Observable的运算符有：</p>
<p>1、mergeAll，订阅所有的Observable，当任何一个订阅的Observable发送值的时候，将值发送出去。</p>
<p>2、switchAll，订阅第一个Observable，当数据到来时，把数据发送出去。但是当下一个Observerable到来时，取消第一个Observerable的订阅。依次类推。</p>
<p>3、exhaust，订阅第一个Observable，当数据到来时，将数据发送出去。直到第一个Observable完成时，忽略掉所有新进的Observable。第一个Observable完成后，再订阅后面的Observable。</p>
<p>flat和map结合的运算符：1、flatMap；2、concatMap；3、mergeMap；4、switchMap；5、exhaustMap。</p>
<h3 id="-">图解</h3>
<p>要解释运算符如何工作，文字描述有时候不太好解释。好多运算符和时间有关，它们可能是实例延迟，取样，节流或防抖。</p>
<h3 id="-">运算符种类</h3>
<p>有多种用途的操作符，可以被分类为：创建，转换，过滤，joining，多播，错误处理，工具类等。</p>
<h4 id="-">创建类</h4>
<p>1、ajax，创建一个http请求。</p>
<p>2、bindCallback，将callback转换为Observable。</p>
<p>3、bindNodeCallback，将node类的callback方法转换为Observable。</p>
<p>4、defer。懒创建Observable，只有订阅时才创建。</p>
<p>5、empty，创建一个不发送任何数据，并且立刻发送complete通知的Observable。已经弃用，使用of()即可。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">//新版本中empty已弃用，只要用of即可。</span>
<span class="nx">of</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">startWith</span><span class="p">(</span><span class="mi">7</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">});</span>
</pre></div>

</code></pre>
<p>6、from，从数组，类数组，Promise实例，迭代器对象，或类Observable的对象创建。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="p">})).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">});</span>
</pre></div>

</code></pre>
<p>7、fromEvent，监听给定的target上的指定的event类型，然后发送这个事件。可以支持DOM，NodeJS EventEmitter，JQuery-like event，NodeJS List 或HTMLCollection。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">)</span>
</pre></div>

</code></pre>
<p>8、fromEventPattern，参数为addHandler，和removeHandler。</p>
<p>9、generate，需要传入迭代器方法，输出判断方法，初始状态等数据。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="c1">//参数数量过多，不如使用options方便。</span>
<span class="nx">generate</span><span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">({</span>
    <span class="nx">initialState</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">condition</span><span class="o">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span>
    <span class="nx">iterate</span><span class="o">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>10、interval，每隔多少毫秒发出一个数据。</p>
<p>11、of，依次发送参数列表的数据。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</code></pre>
<p>12、range，(start,count?,scheduler)，主要是生成数字。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>13、throwError，返回一个直接创建错误的Observable的实例。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">throwError</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="err">`</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">error</span><span class="o">!</span><span class="err">`</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="nx">error</span><span class="o">:</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>14、timer，创建一个等待一段时间然后complete的Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">timer</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

</code></pre>
<p>15、iif，在订阅时检查一个boolean值，然后再两个Observable中选择。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">let</span> <span class="nx">isFirst</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">iif</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">isFirst</span> <span class="p">},</span> <span class="nx">of</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nx">of</span><span class="p">(</span><span class="mi">2</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<h4 id="-">合并创建类</h4>
<p>主要是合并多个来源的的Observeable发送的数据。</p>
<p>1、combineLatest，合并多个Observable的数据。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">firstTimer</span> <span class="o">=</span> <span class="nx">timer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">secondTimer</span> <span class="o">=</span> <span class="nx">timer</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">combineLatest</span><span class="p">([</span><span class="nx">firstTimer</span><span class="p">,</span> <span class="nx">secondTimer</span><span class="p">]).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>发送数据时机：当任何一个Observable发送一个数据时，它就会取监听的所有Observable的最新值组成一个数组来发送数据。</p>
<p>2、concat，监听第一个Observable，第一个Observable完成后，向下一个移动。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">timerOne</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
<span class="kr">const</span> <span class="nx">seqOne</span> <span class="o">=</span> <span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">concat</span><span class="p">(</span><span class="nx">timerOne</span><span class="p">,</span> <span class="nx">seqOne</span><span class="p">);</span>
<span class="nx">result</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// 0 -1000ms-&gt; 1 -1000ms-&gt; 2 -1000ms-&gt; 3 -immediate-&gt; 1 ... 10</span>
</pre></div>

</code></pre>
<p>总结：合并多个Observable的输出。</p>
<p>3、frokJoin，接受一个数组或对象，返回一个Observable，发送的值格式是数组或对象，内容是参数Observable发送的数据。</p>
<p>等待所有的Observable完成，然后混合Observable发送的最后的值。如果参数是空数组，则立刻完成。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">forkJoin</span><span class="p">({</span>
    <span class="nx">foo</span><span class="o">:</span> <span class="nx">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="nx">bar</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
    <span class="nx">baz</span><span class="o">:</span> <span class="nx">timer</span><span class="p">(</span><span class="mi">4000</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">complete</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">Complete</span> <span class="nx">now</span><span class="o">!</span><span class="err">`</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="c1">// after 4 seconds:</span>
<span class="c1">// {foo: 4, bar: 8, baz: 0}</span>
<span class="c1">// Complete now!</span>
</pre></div>

</code></pre>
<p>4、merge，创建一个Observable，发送所有输入的Observable发出的所有值。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">clicksOrTimer</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">clicks</span><span class="p">,</span> <span class="nx">timer</span><span class="p">);</span>
<span class="nx">clicksOrTimer</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>5、partition，把输入的Observable分为两个，一个发送符合条件的值的Observable，一个发送不符合条件的值Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="p">[</span><span class="nx">evens$</span><span class="p">,</span> <span class="nx">odds$</span><span class="p">]</span> <span class="o">=</span> <span class="nx">partition</span><span class="p">(</span><span class="nx">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">val</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>

<span class="nx">evens$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">evens</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">x</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">odds$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">odds</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">x</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>6、race，创建一个新的Observable来反映第一个发送数据的Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">race</span><span class="p">(</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mapTo</span><span class="p">(</span><span class="s1">&#39;fast one&#39;</span><span class="p">)),</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">2000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mapTo</span><span class="p">(</span><span class="s1">&#39;medium one&#39;</span><span class="p">)),</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">3000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mapTo</span><span class="p">(</span><span class="s1">&#39;slow one&#39;</span><span class="p">))).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">winner</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">winner</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>7、zip，多个Observable的值打包到一起。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">zip</span><span class="p">(</span><span class="nx">of</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="nx">of</span><span class="p">(</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Bar&#39;</span><span class="p">,</span> <span class="s1">&#39;Beer&#39;</span><span class="p">),</span> <span class="nx">of</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<h4 id="-">转变类运算符</h4>
<p>1、buffer，缓存输入的Observable的值，直到输入的Observable关闭或另一个Observable发送数据。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">fromEvent</span><span class="p">,</span> <span class="nx">interval</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">buffer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">intervalEvents</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">buffered</span> <span class="o">=</span> <span class="nx">intervalEvents</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">clicks</span><span class="p">));</span>
<span class="nx">buffered</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
<span class="c1">//只在click时，才发送interval的值。[0,1,2,3,4,5,6,...]</span>
</pre></div>

</code></pre>
<p>2、bufferCount，缓存输入的Observable的值，直到缓存大小达到bufferSize。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">fromEvent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">bufferCount</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">buffered</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bufferCount</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="nx">buffered</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>3、bufferTime，缓存输入的Observable的值，直到达到缓存时间。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">fromEvent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">bufferTime</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">buffered</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bufferTime</span><span class="p">(</span><span class="mi">1000</span><span class="p">));</span>
<span class="nx">buffered</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>4、bufferToggle，输入参数两个Observable，一个open，一个close。缓存时间从open的Observable发送数据直到close的Observable发送数据为止。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">fromEvent</span><span class="p">,</span> <span class="nx">interval</span><span class="p">,</span> <span class="nx">EMPTY</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">bufferToggle</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">openings</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">buffered</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bufferToggle</span><span class="p">(</span><span class="nx">openings</span><span class="p">,</span> <span class="nx">i</span> <span class="o">=&gt;</span>
  <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">?</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="o">:</span> <span class="nx">EMPTY</span>
<span class="p">));</span>
<span class="nx">buffered</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>5、bufferWhen，缓存输入的Observable的值，直到Close的Observable发送数据为止。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span> <span class="nx">fromEvent</span><span class="p">,</span> <span class="nx">interval</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">bufferWhen</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs/operators&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">buffered</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">bufferWhen</span><span class="p">(()</span> <span class="o">=&gt;</span>
  <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">4000</span><span class="p">)</span>
<span class="p">));</span>
<span class="nx">buffered</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>6、concatMap，将输入Observable的每个值，传递给输出的Observable，直到完成后，才去处理输入Observable发送的下一个数据。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
  <span class="nx">concatMap</span><span class="p">(</span><span class="nx">ev</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
<span class="p">);</span>
<span class="nx">result</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>7、concatMapTo，和concatMap相似，但是map的每个值都到同一个Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">concatMapTo</span><span class="p">(</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">))),</span>
<span class="p">);</span>
<span class="nx">result</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>8、groupBy，接受一个函数来对数据进行分组，然后产生数个Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">of</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;JS&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Parcel&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Webpack&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;TS&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;TSLint&#39;</span> <span class="p">}).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">groupBy</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span> <span class="nx">mergeMap</span><span class="p">(</span><span class="nx">group$</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">group$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">curr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">//@ts-ignore</span>
            <span class="nx">acc</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">curr</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
        <span class="p">},</span> <span class="p">[]))</span>
    <span class="p">})).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>

</code></pre>
<p>9、map，和Array.prototype.map比较相似。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">((</span><span class="nx">ev</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">ev</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>10、mapTo，map到一个特定的值。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">greetings</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mapTo</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">));</span>
<span class="nx">greetings</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>11、mergeMap，Map Observable的每一个值，然后使用mergeAll打平内部的Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">of</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mergeMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">i</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">i</span><span class="p">))</span>
<span class="p">})).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>12、mergeMapTo，和mergeMap类似，只是总是map到同一个内部Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">clicks</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mergeMapTo</span><span class="p">(</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">)));</span>
<span class="nx">result</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>13、mergeScan，和scan很像，但是返回的Observable和外层Observable。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">one$</span> <span class="o">=</span> <span class="nx">click$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mapTo</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="kr">const</span> <span class="nx">seed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">count$</span> <span class="o">=</span> <span class="nx">one$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">mergeScan</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">one</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">of</span><span class="p">(</span><span class="nx">acc</span> <span class="o">+</span> <span class="nx">one</span><span class="p">),</span> <span class="nx">seed</span><span class="p">),</span>
<span class="p">);</span>
<span class="nx">count$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</pre></div>

</code></pre>
<p>14、pairwise，把当前的值和上一个的值放到一个数组里，然后发送出去。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">pairwise</span><span class="p">()).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">((</span><span class="nx">pair</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">x0</span> <span class="o">=</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">y0</span> <span class="o">=</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">clientY</span><span class="p">;</span>

    <span class="kr">const</span> <span class="nx">x1</span> <span class="o">=</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">y1</span> <span class="o">=</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">clientY</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">x0</span> <span class="o">-</span> <span class="nx">x1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">y0</span> <span class="o">-</span> <span class="nx">y1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">})).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<p>15、partition，將Observable根据分组条件分成两个Observable。该操作符已经弃用。</p>
<p>16、pluck，将每个值map到该值得属性上。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">pluck</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;tagName&#39;</span><span class="p">)).</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<h2 id="-">参考文档</h2>
<p>1、<a href="https://rxjs.dev/guide/overview">https://rxjs.dev/guide/overview</a></p>
</body>
</html>
