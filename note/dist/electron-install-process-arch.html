<!DOCTYPE html>
<html>
<head>
  <title>Electron-安装和进程模型</title>
  <link rel="stylesheet" href="/note/note.css?ts=1644509575061">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><link rel="shortcut icon" href="/ico.png"></head>
<body><script>var _hmt = _hmt || [];
(function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?256376ad73e3e50091706bb3c032e74c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>
<h1 id="electron-">Electron-安装和进程模型</h1>
<h2 id="-">安装指导</h2>
<p>要安装预编译的Electron二进制文件，请使用npm。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">npm</span> <span class="nx">i</span> <span class="nx">electron</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
</pre></div>

</code></pre>
<h3 id="-electron">临时运行electron</h3>
<p>如果你不想再本地工程上使用npm install同时又没有其它选择时，你可以使用npm捆绑的npx命令来运行。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">npx</span> <span class="nx">electron</span> <span class="p">.</span>
</pre></div>

</code></pre>
<p>上面的命令会在当前工作目录下运行Electron，需要注意的是，你的英语中的任何依赖将不会被安装。</p>
<h3 id="-">下载其它位版本</h3>
<p>如果想下载其它位版本，可以设置npm_config_arch环境变量，或使用--arch标记。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">npm</span> <span class="nx">i</span> <span class="o">--</span><span class="nx">arch</span><span class="o">=</span><span class="nx">ia32</span> <span class="nx">electron</span>
</pre></div>

</code></pre>
<p>此外，还可以使用--platform来指定开发平台。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">npm</span> <span class="nx">i</span> <span class="o">--</span><span class="nx">platform</span><span class="o">=</span><span class="nx">win32</span> <span class="nx">electron</span>
</pre></div>

</code></pre>
<h3 id="-">代理</h3>
<p>如果你需要使用HTTP代理，需要设置ELECTRON_GET_USER_PROXY变量。</p>
<h3 id="-">自定义镜像和缓存</h3>
<p>安装过程中，electron模块会通过electron-download为您的平台下载Electron的预编译二进制文件。这将访问Github的发布下载页面(<a href="https://github.com/electron/electron/releases/tag/v$VERSION)来完成。">https://github.com/electron/electron/releases/tag/v$VERSION)来完成。</a></p>
<p>如果您无法访问github，或者您需要自定义构建，则可以通过提供镜像或现有的缓存目录来实现。</p>
<h4 id="-">镜像</h4>
<p>可以使用环境变量来覆盖基本的URL，查找Electron二进制文件的路径拼接规则如下。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">url</span> <span class="o">=</span> <span class="nx">ELECTRON_MIRROR</span> <span class="o">+</span> <span class="nx">ELECTRON_CUSTOM_DIR</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">ELECTRON_CUSTOM_FILENAME</span>
<span class="c1">// 使用中国的镜像</span>
<span class="nx">ELECTRON_MIRROR</span><span class="o">=</span><span class="s2">&quot;https://cdn.npm.taobao.org/dist/electron/&quot;</span>
<span class="nx">ELECTRON_CUSTOM_DIR</span><span class="o">=</span><span class="s2">&quot;{{ version }}&quot;</span>
</pre></div>

</code></pre>
<p>默认情况下，ELECTRON_CUSTOM_DIR被设置为v$VERSION，要更改格式，请使用{{version}}占位符。</p>
<p>如果您的镜像在官方Electron版本中提供不同校验和，你可能必须将ELECTRON_USE_REMOTE_CHECKSUMS设置为1，这将为Electron使用远程SHASUMS256.txt文件来验证校验。</p>
<h4 id="-">缓存</h4>
<p>electron-download会将下载的二进制文件缓存到本地目录中，不会增加后续网络负担。你可以使用该缓存文件夹来提供Electron的定制版本，或者避免进行网络连接。</p>
<p>Linux：$XDG_CACHE_HOME，~/.cache/electron。<br>MacOS：~/Library/Caches/electron/<br>Windows：$LOCALAPPDATA/electron/Cache，~/AppData/Local/electron/Cache。</p>
<p>可以使用electron_config_cache环境变量来覆盖本地缓存位置。</p>
<p>缓存中包含了以文本文件形式存储的带有校验和的版本官方zio文件。</p>
<pre><code class="lang-bash"><div class="highlight"><pre>65a861ed1c947e25d9f47192ec3f17fe4a89e4d3085666f18624f58d3ffe5110
    electron-v17.0.0-darwin-x64.zip
</pre></div>

</code></pre>
<h3 id="-">跳过二进制包下载</h3>
<p>在底层，Electron的JS API绑定了包含默认实现的二进制文件。由于二进制文件对于任何Electron应用的功能都至关重要，每次你从npm install electron时，默认情况下都会在postInstall步骤中下载该二进制文件。</p>
<p>但是，如果你想要安装你的项目依赖，但又不需要使用Electron功能，可以设置ELECTRON_SKIP_BINARY_DOWNLOAD环境变量来阻止二进制文件被下载。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">ELECRON_SKIP_BINARY_DOWNOAD</span><span class="o">=</span><span class="mi">1</span> <span class="nx">npm</span> <span class="nx">install</span>
</pre></div>

</code></pre>
<h3 id="-">故障排查</h3>
<p>在运行npm install electron时，有些用户会偶尔遇到安装问题。大多数情况下，这些错误都是由网络问题导致。</p>
<p>像ELIFECYCLE、EAI_AGAIN、ECONNRESET和ETIMEOUT等错误都是此类网络问题的标志。最佳的解决方案是尝试切换网络，然后再试一次。</p>
<p>如果安装失败并报EACCESS，需要修复npm权限。如果持续出现该错误，可以执行下面的命令。</p>
<pre><code class="lang-bash"><div class="highlight"><pre>sudo npm install electron --unsafe-perm<span class="o">=</span><span class="nb">true</span>
</pre></div>

</code></pre>
<p>在较慢的网络上，最好使用--verbose标志来显示下载进度。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">verbose</span> <span class="nx">electron</span>
</pre></div>

</code></pre>
<p>如果需要强制重新下载文件，需要将force_no_cache环境变量设置为true。</p>
<h2 id="-">进程模型</h2>
</body>
</html>
