<!DOCTYPE html>
<html>
<head>
  <title>微前端工程实现</title>
  <link rel="stylesheet" href="/note/note.css">
</head>
<body>
<h1 id="-">微前端工程实现</h1>
<h2 id="-">前言</h2>
<p>本文不论证做不做微前端，只谈如何实现微前端。</p>
<h2 id="-">主应用和子应用</h2>
<p>微前端在逻辑上需要将应用划分为主应用和子应用。</p>
<p>主应用功能包括：<br>1、注册子应用；<br>2、切换子应用（子应用生命周期以及子应用资源管理），沙盒机制；<br>4、公共展示区域（导航栏，header，footer，子应用占位元素等）；<br>5、子应用权限管理；<br>6、应用间共享的方法，数据，应用通信总线。</p>
<p>子应用功能包括：主要是业务页面。</p>
<pre><code><div class="highlight"><pre><span class="err">子应用应该按照业务或功能划分，尽量做到子应用独立，子应用之间不要有太多交互。</span>
</pre></div>

</code></pre><h2 id="-">项目改造</h2>
<h3 id="-">打包构建</h3>
<p>主应用打包构建和传统SPA 差异不大。</p>
<p>子应用打包构建和传统 SPA 主要是产物的区别。</p>
<p>传统SPA，构建产物为 HTML 文件和资源文件（CSS，JS，IMG等）。</p>
<p>子应用，构建产物只是资源文件（CSS，JS，IMG等），子应用入口文件需要导出特定函数以供主应用调用。</p>
<pre><code><div class="highlight"><pre><span class="err">子应用可以既编译为传统</span><span class="nx">SPA</span><span class="err">，又编译为“微前端子应用”。这样子应用可以被独立使用。</span>
</pre></div>

</code></pre><h3 id="-">本地开发</h3>
<p>主应用本地开发和传统SPA类似。</p>
<p>子应用本地开发可以本地起该子应用的页面，本地开发测试完成后，部署到相应环境进行集成测试。</p>
<pre><code><div class="highlight"><pre><span class="err">如果想本地直接集成测试，可以将主应用页面起来，然后替换目前子应用资源地址。</span>
</pre></div>

</code></pre><h3 id="-">开发规范</h3>
<p>为了接入主应用以及更好得运行，子应用和主应用应该遵循的的规则。</p>
<h3 id="-">接口改造</h3>
<p>有了主应用后，所有请求都是主应用域名发出去的。对于一些子应用接口可能会存在跨域问题。</p>
<p>解决方案有两种：</p>
<p>1、子应用接口方支持CORS协议(nginx 配置即可)；</p>
<p>2、主应用服务器进行nginx代理。</p>
<h2 id="-">微前端应用管理系统</h2>
<p>微前端应用管理系统主要包括以下功能：</p>
<p>1、应用环境管理，test，stage，prod</p>
<p>2、应用管理，主应用创建&amp;&amp;编辑，子应用创建&amp;&amp;编辑</p>
<p>3、主应用菜单管理，eg：包含哪些子应用，哪些子应用页面</p>
<p>4、子应用资源管理，子应用菜单管理</p>
<p>5、对外接口，eg：子应用更新资源接口，主应用获取子应用接口</p>
</body>
</html>
