<!DOCTYPE html>
<html>
<head>
  <title>Electron使用sqlite3</title>
  <link rel="stylesheet" href="/note/note.css?ts=1660578262626">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><link rel="shortcut icon" href="/ico.png"></head>
<body><script>var _hmt = _hmt || [];
(function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?256376ad73e3e50091706bb3c032e74c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>
<h1 id="electron-sqlite3">Electron使用sqlite3</h1>
<h2 id="-">安装</h2>
<pre><code class="lang-bash"><div class="highlight"><pre>npm i sqlite3
</pre></div>

</code></pre>
<h2 id="-">预编译二进制文件</h2>
<p>sqlite3 v5使用Node-API重写，所以不用为特定的Node版本编译。sqlite3的编译产物可以在Node-API V3和Node-API V6上使用。</p>
<p>Node V10+的支持预构建的二进制文件，模块使用node-pre-gyp来下载当前平台支持的二进制包。如果你的环境找不到合适的二进制文件，会使用node-gyp来构建当前环境支持的二进制文件。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">sqlite3</span> <span class="nx">from</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nx">Database</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">);</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="err">`</span><span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="nx">lorem</span> <span class="p">(</span><span class="nx">info</span> <span class="nx">text</span><span class="p">)</span><span class="err">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s1">&#39;Insert&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">stmt</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT INTO lorem VALUES(?)&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">stmt</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="err">`</span><span class="nx">Ipsum</span> <span class="err">`</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">stmt</span><span class="p">.</span><span class="nx">finalize</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s1">&#39;Insert&#39;</span><span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">)</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="s2">&quot;SELECT rowid AS id, info FROM lorem WHERE rowid=10&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">row</span><span class="p">.</span><span class="nx">info</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s1">&#39;Query&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<h2 id="api">API</h2>
<h3 id="new-sqlite3-database">new sqlite3.DataBase</h3>
<p>new sqlite3.Database(filename[,mode][,callback])返回一个数据库对象并自动打开数据库，没有其它的方法可以打开数据库。</p>
<p>filename：&quot;:memory:&quot;会生成匿名的内存数据库；空字符串会产生匿名的硬盘数据库，匿名的数据库在关闭数据库时，会丢失内容。</p>
<p>mode：可选，sqllite3.OPEN_READONLY，sqlite3.OPEN_READWRITE，sqlite3.OPEN_CREATE，sqlite3.OPEN_FULLMUTEX，sqllite3.OPEN_URI，sqlite3.OPEN_SHAREDCACHE，sqlite3.OPEN_PRIVATECACHE。默认值的为OPEN_READWRITE|OPEN_CREATE|OPEN_FULLMUTEX。</p>
<p>callback：可选，提供了，当DB打开成功或失败时，都会调用该回调方法。</p>
<p>打开成功时候，会触发open事件，打开失败时，会触发error事件。</p>
</body>
</html>
