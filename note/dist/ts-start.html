<!DOCTYPE html>
<html>
<head>
  <title>Typescript-One</title>
  <link rel="stylesheet" href="/note/note.css?ts=1648657212001">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><link rel="shortcut icon" href="/ico.png"></head>
<body><script>var _hmt = _hmt || [];
(function () {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?256376ad73e3e50091706bb3c032e74c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>
<h1 id="typescript-one">Typescript-One</h1>
<p>TS只是在JS的基础上添加了类型系统。优点是可以在构建时发现更多错误，可以使用JS不支持的高级功能。</p>
<h2 id="-">类型推断</h2>
<p>根据赋值的值来推断变量的类型。</p>
<pre><code class="lang-js"><div class="highlight"><pre><span class="kd">let</span> <span class="nx">helloWorld</span> <span class="o">=</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">;</span>
<span class="c1">//let helloWorld:string</span>
</pre></div>

</code></pre>
<h2 id="-">类型声明</h2>
<p>你可以在JS中使用许多设计模式。一些设计模式使得类型推断很难，在这种情况下，TS支持JS语言的声明文件和直接声明，你可以在声明文件中提供TS的类型声明。</p>
<pre><code class="lang-ts"><div class="highlight"><pre><span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
    <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
    <span class="nx">id</span>: <span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">user</span>: <span class="kt">User</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;hayes&quot;</span><span class="p">,</span>
    <span class="nx">id</span>: <span class="kt">0</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">UserAccount</span> <span class="p">{</span>
    <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
    <span class="nx">id</span>: <span class="kt">number</span><span class="p">;</span>

    <span class="kr">constructor</span><span class="p">(</span><span class="nx">name</span>:<span class="kt">string</span><span class="p">,</span> <span class="nx">id</span>:<span class="kt">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// class的实例</span>
<span class="kr">const</span> <span class="nx">user</span>:<span class="kt">User</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserAccount</span><span class="p">(</span><span class="s1">&#39;Murpht&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">//注释函数参数类型和返回值</span>
<span class="kd">function</span> <span class="nx">getAdminUser</span><span class="p">()</span><span class="o">:</span><span class="nx">User</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">deleteUser</span><span class="p">(</span><span class="nx">user</span>:<span class="kt">User</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<p>TS有的类型：boolean，bigint，null，number，string，symbol，undefined，any(允许任何类型)，unknown(使用时需要转换类型)，never(不会发生的类型)，void(函数返回undefined)。</p>
<p>你可以使用Interface和Type来声明类型，应该首选interface，除非是声明类型别名。</p>
<h2 id="-">复合类型</h2>
<p>将简单的类型们合成一个复合类型。</p>
<h3 id="unions-">Unions-联合体</h3>
<pre><code class="lang-ts"><div class="highlight"><pre><span class="c1">//联合体常用于字符串或数字</span>
<span class="nx">type</span> <span class="nx">WindowStates</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span> <span class="o">|</span> <span class="s2">&quot;closed&quot;</span> <span class="o">|</span> <span class="s2">&quot;minimized&quot;</span><span class="p">;</span>
<span class="nx">type</span> <span class="nx">LockStates</span> <span class="o">=</span> <span class="s2">&quot;locked&quot;</span> <span class="o">|</span> <span class="s2">&quot;unlocked&quot;</span><span class="p">;</span>
<span class="nx">type</span> <span class="nx">PositiveOddNumberUnderTen</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">3</span> <span class="o">|</span> <span class="mi">5</span> <span class="o">|</span> <span class="mi">7</span> <span class="o">|</span> <span class="mi">9</span><span class="p">;</span>
<span class="c1">//联合体也可用于不同的类型</span>
<span class="kd">function</span> <span class="nx">getLength</span><span class="p">(</span><span class="nx">obj</span>: <span class="kt">string</span> <span class="o">|</span> <span class="kt">string</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// 使用typeof来判断参数类型</span>
<span class="kd">function</span> <span class="nx">wrapInArray</span><span class="p">(</span><span class="nx">obj</span>: <span class="kt">string</span> <span class="o">|</span> <span class="kt">string</span><span class="p">[])</span><span class="o">:</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nx">obj</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<h2 id="-">泛型</h2>
<p>泛型主要提供了类型变量。</p>
<pre><code class="lang-ts"><div class="highlight"><pre><span class="nx">type</span> <span class="nx">StringArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
<span class="nx">type</span> <span class="nx">NumberArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="kt">number</span><span class="o">&gt;</span><span class="p">;</span>
<span class="nx">type</span> <span class="nx">ObjectWithNameArray</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="nx">name</span>:<span class="kt">string</span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
<span class="c1">//</span>
<span class="kr">interface</span> <span class="nx">BackPack</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nx">add</span><span class="o">:</span> <span class="p">(</span><span class="nx">obj</span>:<span class="kt">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
    <span class="nx">get</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span>
<span class="p">}</span>
<span class="c1">// 告诉TS，有一个backpack的变量，不用关心该变量来自何处</span>
<span class="kr">declare</span> <span class="kr">const</span> <span class="nx">backpack</span>: <span class="kt">Backpack</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
<span class="nx">backpack</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
</pre></div>

</code></pre>
<h2 id="-">结构类型</h2>
<p>TS的核心原则聚焦于值拥有的类型，这在某些时候叫鸭式类型或结构类型。</p>
<p>结构类型中，如果两个对象拥有相同的属性，它们会被认为有相同的类型。</p>
<pre><code class="lang-ts"><div class="highlight"><pre><span class="kr">interface</span> <span class="nx">Point</span> <span class="p">{</span>
    <span class="nx">x</span>: <span class="kt">number</span><span class="p">;</span>
    <span class="nx">y</span>: <span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">logPoint</span><span class="p">(</span><span class="nx">p</span>:<span class="kt">Point</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">},</span><span class="nx">$</span><span class="p">{</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">point</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">x</span>: <span class="kt">12</span><span class="p">,</span> <span class="nx">y</span>: <span class="kt">36</span> <span class="p">};</span>
<span class="c1">//TS对比了point的属性。</span>
<span class="nx">logPoint</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
<span class="c1">//结构类型匹配值匹配对象的属性子集</span>
<span class="kr">const</span> <span class="nx">point3</span> <span class="o">=</span> <span class="p">{</span><span class="nx">x</span>: <span class="kt">12</span> <span class="p">,</span><span class="nx">y</span>: <span class="kt">26</span><span class="p">,</span> <span class="nx">z</span>: <span class="kt">89</span> <span class="p">};</span>
<span class="nx">logPoint</span><span class="p">(</span><span class="nx">point3</span><span class="p">);</span>
<span class="c1">//class的匹配</span>
<span class="kr">class</span> <span class="nx">VirtualPoint</span> <span class="p">{</span>
    <span class="nx">x</span>: <span class="kt">number</span><span class="p">;</span>
    <span class="nx">y</span>: <span class="kt">number</span><span class="p">;</span>

    <span class="kr">constructor</span><span class="p">(</span><span class="nx">x</span>:<span class="kt">number</span><span class="p">,</span><span class="nx">y</span>:<span class="kt">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">newVPoint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VirtualPoint</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">56</span><span class="p">);</span>
<span class="nx">logPoint</span><span class="p">(</span><span class="nx">newVPoint</span><span class="p">)</span>
</pre></div>

</code></pre>
<h2 id="-">基础</h2>
<h3 id="-">静态类型检查</h3>
<p>TypeError相关的错误在JS的语言中比较常见。静态类型检查描述的是值的类型和表现，TS等静态类型系统告诉我们有哪些值的类型和表现不符合预期。</p>
<pre><code class="lang-ts"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;hello!&#39;</span><span class="p">;</span>
<span class="nx">message</span><span class="p">();</span>
<span class="c1">// Error - Type &#39;String&#39; has no call signatures.</span>
</pre></div>

</code></pre>
<h3 id="-">非运行异常错误</h3>
<p>TS报告的异常情况是根据ECMAScript规范的定义来的。eg：调用未定义的属性返回undefined，调用不可调用的属性直接返回错误。</p>
<p>因为添加了类型系统，即使在某些情况下，代码是合格的JS代码，不会产生错误，TS也会提示错误，目的是捕获更多合法的错误。</p>
<pre><code class="lang-ts"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Daniel&quot;</span><span class="p">,</span>
    <span class="nx">age</span>: <span class="kt">26</span>
<span class="p">}</span>

<span class="nx">user</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span>
<span class="c1">// Error,不存在location属性</span>
<span class="c1">// typos</span>
<span class="kr">const</span> <span class="nx">announcement</span> <span class="o">=</span> <span class="s2">&quot;Hello World!&quot;</span><span class="p">;</span>
<span class="c1">// How quickly can you spot the typos?</span>
<span class="nx">announcement</span><span class="p">.</span><span class="nx">toLocaleLowercase</span><span class="p">();</span>
<span class="nx">announcement</span><span class="p">.</span><span class="nx">toLocalLowerCase</span><span class="p">();</span>
<span class="c1">// We probably meant to write this...</span>
<span class="nx">announcement</span><span class="p">.</span><span class="nx">toLocaleLowerCase</span><span class="p">();</span>
<span class="c1">// 未调用方法</span>
<span class="kd">function</span> <span class="nx">flipCoin() {</span>
  <span class="c1">// Meant to be Math.random()</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="nx">Operator</span> <span class="s1">&#39;&lt;&#39;</span> <span class="nx">cannot</span> <span class="nx">be</span> <span class="nx">applied</span> <span class="nx">to</span> <span class="nx">types</span> <span class="s1">&#39;() =&gt; number&#39;</span> <span class="nx">and</span> <span class="s1">&#39;number&#39;</span><span class="p">.</span>
<span class="p">}</span>
<span class="c1">//逻辑错误</span>
<span class="kr">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="o">?</span> <span class="s2">&quot;a&quot;</span> <span class="o">:</span> <span class="s2">&quot;b&quot;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">This</span> <span class="nx">condition</span> <span class="nx">will</span> <span class="nx">always</span> <span class="k">return</span> <span class="s1">&#39;false&#39;</span> <span class="nx">since</span> <span class="nx">the</span> <span class="nx">types</span> <span class="s1">&#39;&quot;a&quot;&#39;</span> <span class="nx">and</span> <span class="s1">&#39;&quot;b&quot;&#39;</span> <span class="nx">have</span> <span class="nx">no</span> <span class="nx">overlap</span><span class="p">.</span>
  <span class="c1">// Oops, unreachable</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<h3 id="-">类型工具</h3>
<p>根据类型信息，可以做智能提示，可以提供自动快速修复功能，重构代码，跳转到定义和实现等功能，发现所有引用。</p>
<h3 id="tsc-typescript-">tsc-Typescript的编译器</h3>
<pre><code class="lang-bash"><div class="highlight"><pre>npm i typescript -g
<span class="c"># 将tsc命令安装到全局，npx之类的工具可以运行本地安装的tsc命令</span>
</pre></div>

</code></pre>
<h3 id="-">错误时也输出内容</h3>
<p>TSC报告的错误只是基于它内置的数据，大多数时候，你比TSC更加了解情况。</p>
<p>某些情况下你需要即使有错误也编译输出的情况，比如将JS库转为TS的过程中。</p>
<p>你可以指定noEmitOnError选项来避免输出。</p>
<pre><code class="lang-bash"><div class="highlight"><pre>tsc --noEmitOnError hello.ts
</pre></div>

</code></pre>
</body>
</html>
