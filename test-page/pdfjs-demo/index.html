<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDFjs-Demo</title>
    <script src="./scripts/pdf.js"></script>
    <style>
      .preview-container {
        position: fixed;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        margin: 0px;
        background-color: rgb(82, 86, 89);
        overflow-y: auto;
        overflow-x: auto;
        flex-direction: column;
        align-items: center;
      }

      .preview-scroll {
        padding: 20px;
        min-width: 1100px;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }

      .preview-container .canvas-wrapper:not(:last-child) {
        margin-top: 15px;
      }
    </style>
    <script>
      window.onload = function () {
        const url = "./test-pdf.pdf";
        pdfjsLib.GlobalWorkerOptions.workerSrc = "./scripts/pdf-worker.js";

        const loadingTask = pdfjsLib.getDocument(url);

        (async () => {
          const pdf = await loadingTask.promise;
          const page = await pdf.getPage(1);
          const scale = 1.35;

          const previewContainerEl = document.querySelector(".preview-scroll");

          function drawPageToCanvas(page) {
            const viewport = page.getViewport({ scale });

            const divWrapperEl = document.createElement("div");
            divWrapperEl.classList.add("canvas-wrapper");
            const pageCanvas = document.createElement("canvas");
            divWrapperEl.appendChild(pageCanvas);
            previewContainerEl.appendChild(divWrapperEl);
            const context = pageCanvas.getContext("2d");

            const outputScale = window.devicePixelRatio || 1;
            pageCanvas.width = Math.floor(viewport.width * outputScale);
            pageCanvas.height = Math.floor(viewport.height * outputScale);
            pageCanvas.style.width = Math.floor(viewport.width) + "px";
            pageCanvas.style.height = Math.floor(viewport.height) + "px";

            const transform =
              outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : null;

            const renderContext = {
              canvasContext: context,
              transform,
              viewport,
            };
            page.render(renderContext);
          }

          const numPages = pdf.numPages;
          for (let i = 1; i <= numPages; i++) {
            try {
              const page = await pdf.getPage(i);
              drawPageToCanvas(page);
            } catch (ex) {
              console.error(ex);
            }
          }
        })();
      };
    </script>
  </head>
  <body>
    <div class="preview-container">
      <div class="preview-scroll"></div>
    </div>
  </body>
</html>
